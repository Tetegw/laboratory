## HTTP协议 - 简单的HTTP协议

### 一、概念

HTTP协议：TCP/IP协议族的一个子集，用于客户端和服务端通信必须遵守的规则。通过`请求方法`请求和相应的交换达成客户端和服务端的通信。



### 二、请求方法

告知服务器意图的HTTP方法。

- GET：获取资源
- POST: 传输`实体`主体
- PUT: 传输`文件`
- DELETE: 删除文件
- HEAD、OPTIONS、TRACE、CONNECT



### 三、HTTP报文

用于HTTP协议交互的信息称为HTTP报文，请求端的HTTP报文称为请求报文，响应端的称为响应报文。HTTP报文本身是字符串文本。

HTTP请求报文主要分为请求行、请求头(首部)、主体。

- 请求行

  ①方法 ②URI ③HTTP协议

- 请求头

  请求首部、通用首部、实体首部 （下面分析）

- 主体

  请求的入参、

HTTP响应报文主要分为状态行、响应头(首部)、主体。

- 状态行

  ①协议版本 ②状态码 ③原因

- 响应头

  响应首部、通用首部、实体首部（下面分析）

- 主体

  响应的出参



关于常用的首部列表如下(参考[HTTP全部报文首部字段](http://blog.csdn.net/tigerzx/article/details/60360705))：

**请求首部**

| 首部字段名             | 说明                               |
| ----------------- | -------------------------------- |
| Accept            | 用户代理可处理的媒体类型`text/html`          |
| Accept-Encoding   | 优先的内容编码`gzip`                    |
| Accept-Language   | 优先的语言`en-us,zh`                  |
| Expect            | 期待服务器的特定行为                       |
| Host              | 请求资源所在服务器`www.jianshu.com`       |
| if-Match          | 比较实体标记（ETag）`缓存有关`               |
| if-Modified-Since | 比较资源的更新时间 `缓存有关`                 |
| Referer           | 对请求中URI的原始获取方法 `http://**/f6507` |
| User-Agent        | HTTP客户端程序的信息 `Mozilla/5.0...`    |
| ...               |                                  |



**通用首部字段**

| 首部字段名      | 说明                  |
| ---------- | ------------------- |
| Cache      | 控制缓存的行为，`不读取本地缓存`   |
| Connection | 逐跳首部、连接的管理，`持续连接相关` |
| Date       | 创建报文的日期时间           |
| ...        |                     |



**响应首部字段**

| 首部字段名         | 说明                |
| ------------- | ----------------- |
| Accept-Ranges | 是否接受字节范围请求        |
| Age           | 推算资源创建经过时间 `缓存有关` |
| ETag          | 资源的匹配信息 `缓存有关`    |
| Location      | 令客户端重定向至指定的URI    |
| ...           |                   |



**实体首部字段**

| 首部字段名         | 说明                                       |
| ------------- | ---------------------------------------- |
| Content-Range | 实体主体的位置范围 ``                             |
| Content-Type  | 实体主体的媒体类型 `application/json; charset=utf-8` |
| Expires       | 实体主体过期的日期时间 `缓存有关`                       |
| Last-Modified | 资源的最后修改日期时间 `缓存有关`                       |
| Set-Cookie    | 服务器返回给客户端设置缓存                            |
| ...           |                                          |



### 四、状态码

状态码是用来告知从服务器请求来的结果

| 状态码  | 描述                |
| ---- | ----------------- |
| 1xx  | 请求正在处理            |
| 2xx  | 请求正常处理完毕(success) |
| 3xx  | 重定向               |
| 4xx  | 客户端错误             |
| 5xx  | 服务端错误             |

只要遵守状态码类别的定义，即使改变RFC2616中定义的状态码，或服务器端自行创建状态码都是没有问题的。



### 五、持续连接

在HTTP协议初始版本中，每进行一次HTTP通信就要`断开一次TCP连接`。为了解决这一问题，在HTTP/1.1版本中加入了持续连接（默认是开启的）。

持续连接使得多数请求以`管线化`方式发送成为可能。这样就可以做到并行发送多个请求。



### 六、cookie

无状态：HTTP协议是无状态协议，它不对之前发送过的请求和响应的状态进行管理。也就是说，无法根据之前的状态进行本次的请求处理。

最常见的例子是，登录态无法被保持住。为了解决这一问题，引入了cookie技术，cookie技术是通过在请求和响应首部中加入相关信息，从而达到客户端和服务端的相互识别的通信。

客户端发送`请求` ==>  服务端`生成session`，在响应首部加入`set-Cookie`  ==>  `第二次请求`中带入cookie ==> 检测cookie，识别身份



除了cookie以外，为了服务器性能等提出了tooken技术，具体可参考[干掉状态：从session到token](http://mp.weixin.qq.com/s/rvWY5rIoYib_wDUtXByFIw)





### 参考

> 《图解HTTP》
>
> [HTTP全部报文首部字段](http://blog.csdn.net/tigerzx/article/details/60360705)
>
> [干掉状态：从session到token](http://mp.weixin.qq.com/s/rvWY5rIoYib_wDUtXByFIw)

