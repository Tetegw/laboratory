## 一、Web攻击

简单的HTTP协议本身并**不存在**安全问题，并不会成为攻击对象，然而应用HTTP协议的**服务器**和**客户端**，以及运行在服务器上的Web**应用资源**才是攻击目标。

HTTP最初的设计是一个通用的单纯协议机制，具备较多的优势，但是**也有明显的安全性方面的劣势**。好在如今大多数的Web网站都会使用会话管理(session)、加密处理等安全性方面的功能。



### Web应用的攻击模式

- 主动攻击
- 被动攻击

【主动攻击】是攻击者通过直接访问Web应用，把攻击代码传入的攻击模式。由于该模式是直接针对服务器的资源进行攻击，因此攻击者需要能够访问到那些资源。代表性的攻击有**SQL注入攻击**和**OS命令注入攻击**。

【被动攻击】是指**利用圈套策略执行攻击代码**的攻击模式。在被动攻击过程中，攻击者不直接对目标Web应用访问发起攻击。代表性的攻击有**跨站脚本攻击**和**跨站点请求伪造**。

被动攻击通常的攻击模式如下：

- 步骤1：攻击者诱使用户触发已设置好的陷阱，而陷阱会启动发送已嵌入攻击代码的HTTP请求。
- 步骤2：当用户不知不觉中招之后，用户的浏览器或邮件客户端就会触发这个陷阱。
- 步骤3：中招后的用户浏览器会把含有攻击代码的HTTP请求发送给作为攻击目标的Web应用，运行攻击代码。
- 步骤4：执行完攻击代码，存在安全漏洞的Web应用会成为攻击者的跳板，可能导致用户所持有的Cookie等个人信息被窃取，登录状态中的用户权限被恶意滥用的结果。



#### SQL注入攻击(主动攻击)

SQL注入是指针对Web应用使用的数据库，通过运行非法的SQL而产生的攻击。

Web应用通常需要用到数据库，当需要**对数据库表内的数据进行检索或添加、删除等操作**时，会使用SQL语句连接数据库进行特定的操作。如果在调用SQL语句的方式上存在疏漏，就可能执行被恶意注入非法SQL语句。

> [Web安全之SQL注入攻击技巧与防范](http://www.jianshu.com/p/436917dfa8df)



#### OS命令注入攻击(主动攻击)

是指通过Web应用，执行非法的操作系统命令达到攻击的目的。只要在能调用Shell函数的地方就存在被攻击的风险。



#### 跨站脚本攻击(被动攻击)

是指通过存在安全漏洞的Web网站注册用户的浏览器内运行非法的HTML标签或JavaScript进行的一种攻击。尤其动态创建(用户输入)的HTML部分有可能隐藏着安全漏洞(富文本编辑器)。

> [XSS 跨站脚本攻击Cross Site Script）](http://www.jianshu.com/p/3801c5d76727)



#### HTTP首部注入攻击(被动攻击)

是指攻击者通过在响应首部字段内插入换行，添加任意响应首部或者主体的一种攻击。在发送请求时修改Location以及Set-	Cookie可强制设置任何Cookie信息以及重定向至任何URL。

还有一种将两个`%0D%0A`并排插入字符串后发送，利用这两个连续的换行就可作出HTTP首部与主体分隔所需的空行了，这样就能显示伪造的主体，达到攻击目的。这种攻击叫做HTTP响应截断攻击。



其他的攻击还包括：邮件首部注入攻击、目录遍历攻击、远程文件包含漏洞、强制浏览、不正确的错误消息处理、开发重定向、会话劫持、跨站点请求伪造等攻击方式。详细可查看书籍《图解HTTP》。



## 二、加密处理

近代的加密方法中**加密的算法一般是公开**的，而**密钥却是保密**的。通过这种方式得以保持加密方法的安全性。

加密和解密都会用到密钥。没有密钥就无法对密码解密，反过来说，**任何人只要持有密钥就能解密了**。如果密钥被攻击者获取，那加密也就失去了意义。



### 共享密钥加密

又称**对称密钥**加密，同用一个密钥的方式称为共享密钥加密。![微信截图_20171111154316](E:\github\summarize\HTTP协议\微信截图_20171111154316.png)

在互联网上转发密钥时，如果通信被监听那么密钥就可能落入攻击者之手，同时失去了加密的意义。

![微信截图_20171111154336](E:\github\summarize\HTTP协议\微信截图_20171111154336.png)



### 公开密钥加密

公开密钥加密使用一对非对称的密钥。一把叫做私有密钥，一把叫做公开密钥。

使用公开密钥加密方式，发送密文的一方使用对方的公开密钥进行加密处理，对方收到被加密的信息后，再使用自己的私钥进行解密。

![微信截图_20171111154425](E:\github\summarize\HTTP协议\微信截图_20171111154425.png)

而再之后出现了证明公开密钥正确性的证书，会在接下来的HTTPS中详细讲解。

## 三、安全的HTTPS

前面讲过HTTP在安全性方面有很多缺陷，比如HTTP协议中的请求和响应不会对通信方进行确认。也就是说存在"服务器是否就是发送请求中URI真正指定的主机，返回的响应是否真的返回到实际提出请求的客户端"等类似问题。

### SSL协议

虽然使用HTTP协议无法确定通信方，但是如果使用SSL则可以。SSL不仅提供了**加密处理，摘要功能**，而且还使用了一种被称为**证书**的手段，可用于确定通信方。



> **HTTP + 加密 + 认证 + 完整性保护 = HTTPS**



HTTPS**并非是应用层的一种新协议**，只是HTTP通信接口部分用SSL(安全套接层)和TLS(安全传输层协议)协议替代而已。所谓的HTTPS，其实就是身披SSL协议这层外壳的HTTP。

### 数字证书

遗憾的是，公开密钥加密方式还是存在一些问题的。那就是**无法证明公开密钥本身就是货真价实的公开密钥**。比如，正准备和某台服务器建立公开密钥加密方式下的通信时，如何证明收到的公开密钥就是原本预想的那台服务器发行的公开密钥。或许在公开密钥传输途中，真正的公开密钥已经被攻击者替换掉了。

为了解决上述问题，可以使用由数字证书认证机构和其相关机关颁发的公开密钥证书。首先，服务器的运营人员向数字证书认证机构提出公开密钥的申请。数字证书认证机构在判明提出申请者的身份之后，会对已申请的公开密钥做数字签名，然后分配这个已签名的公开密钥，并将该公开密钥放入公钥证书后绑定在一起。



具体在Web通信中证书如何运作，可以参考下图：

![微信截图_20171111160539](E:\github\summarize\HTTP协议\微信截图_20171111160539.png)

整个HTTPS的通信流程大致如下：

![微信截图_20171111160718](E:\github\summarize\HTTP协议\微信截图_20171111160718.png)



虽说HTTPS通信建立了一个安全通道的信息传输环境，但是也存在一些问题，那就是当使用SSL时，它的处理速度会变慢。**HTTPS比HTTP通信要慢2到100倍**。